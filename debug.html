<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File Upload Debug</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>
<body>
    <div class="container mt-5">
        <h1>File Upload Debug Test</h1>
        
        <div class="row">
            <div class="col-md-6">
                <h3>Test File Upload</h3>
                <input type="file" id="testFile" accept=".xlsx,.xls" class="form-control mb-3">
                <button onclick="testUpload()" class="btn btn-primary">Test Upload</button>
                <div id="uploadResult" class="mt-3"></div>
            </div>
            
            <div class="col-md-6">
                <h3>Event Listener Test</h3>
                <input type="file" id="eventTestFile" accept=".xlsx,.xls" class="form-control mb-3">
                <div id="eventResult" class="mt-3"></div>
            </div>
        </div>
        
        <div class="mt-5">
            <h3>Console Log</h3>
            <div id="consoleLog" class="border p-3 bg-light" style="height: 200px; overflow-y: scroll;"></div>
        </div>
    </div>

    <script>
        // Override console.log to show in the page
        const originalLog = console.log;
        const originalError = console.error;
        
        function addToLog(message, type = 'log') {
            const logDiv = document.getElementById('consoleLog');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = type === 'error' ? 'text-danger' : 'text-dark';
            logEntry.innerHTML = `<strong>[${timestamp}]</strong> ${message}`;
            logDiv.appendChild(logEntry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addToLog(args.join(' '));
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addToLog(args.join(' '), 'error');
        };
        
        // Test file upload
        function testUpload() {
            const fileInput = document.getElementById('testFile');
            const file = fileInput.files[0];
            
            if (!file) {
                document.getElementById('uploadResult').innerHTML = 
                    '<div class="alert alert-warning">No file selected</div>';
                return;
            }
            
            console.log('File selected:', file.name, 'Size:', file.size);
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const sheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[sheetName];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                    
                    console.log('File read successfully:', sheetName, 'Rows:', jsonData.length);
                    
                    document.getElementById('uploadResult').innerHTML = 
                        `<div class="alert alert-success">
                            ‚úÖ File uploaded successfully!<br>
                            Sheet: ${sheetName}<br>
                            Rows: ${jsonData.length - 1}<br>
                            Columns: ${jsonData[0] ? jsonData[0].length : 0}
                        </div>`;
                } catch (error) {
                    console.error('Error reading file:', error);
                    document.getElementById('uploadResult').innerHTML = 
                        `<div class="alert alert-danger">‚ùå Error: ${error.message}</div>`;
                }
            };
            reader.readAsArrayBuffer(file);
        }
        
        // Test event listeners
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, setting up event listeners...');
            
            const eventTestFile = document.getElementById('eventTestFile');
            
            if (eventTestFile) {
                eventTestFile.addEventListener('change', function(e) {
                    console.log('File change event triggered');
                    const file = e.target.files[0];
                    if (file) {
                        document.getElementById('eventResult').innerHTML = 
                            `<div class="alert alert-info">
                                üìÅ File selected via event listener: ${file.name}
                            </div>`;
                    }
                });
                console.log('Event listener attached successfully');
            } else {
                console.error('Event test file input not found');
            }
        });
        
        // Test the actual file inputs from the main app
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Testing main app file inputs...');
            
            const companiesFile = document.getElementById('companiesFile');
            const candidatesFile = document.getElementById('candidatesFile');
            
            if (companiesFile) {
                console.log('Companies file input found');
                companiesFile.addEventListener('change', function(e) {
                    console.log('Companies file change event');
                });
            } else {
                console.error('Companies file input NOT found');
            }
            
            if (candidatesFile) {
                console.log('Candidates file input found');
                candidatesFile.addEventListener('change', function(e) {
                    console.log('Candidates file change event');
                });
            } else {
                console.error('Candidates file input NOT found');
            }
        });
    </script>
</body>
</html> 